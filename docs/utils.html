---

title: Utils


keywords: fastai
sidebar: home_sidebar

summary: "This file holds function to load the data and create folds for cross-validation."
description: "This file holds function to load the data and create folds for cross-validation."
nb_path: "nbks/00_utils.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbks/00_utils.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Load-Data">Load Data<a class="anchor-link" href="#Load-Data"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="load_data" class="doc_header"><code>load_data</code><a href="https://github.com/bwolfson97/plant_pathology/tree/master/plant_pathology/utils.py#L11" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>load_data</code>(<strong><code>with_folds</code></strong>=<em><code>True</code></em>, <strong><code>path_pseudo_labels</code></strong>:<code>str</code>=<em><code>None</code></em>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">path</span><span class="p">,</span> <span class="n">df</span> <span class="o">=</span> <span class="n">load_data</span><span class="p">()</span>
<span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">(),</span> <span class="n">path</span><span class="o">.</span><span class="n">ls</span><span class="p">(),</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>(     image_id  healthy  multiple_diseases  rust  scab  fold
 0  Train_1511        0                  0     1     0   0.0
 1  Train_1799        1                  0     0     0   0.0
 2   Train_135        1                  0     0     0   0.0
 3   Train_408        0                  0     1     0   0.0
 4  Train_1693        1                  0     0     0   0.0,
 (#13) [Path(&#39;/home/jupyter/kaggle/plant-pathology/data/plant-pathology-2020/test.csv&#39;),Path(&#39;/home/jupyter/kaggle/plant-pathology/data/plant-pathology-2020/train_folds.csv&#39;),Path(&#39;/home/jupyter/kaggle/plant-pathology/data/plant-pathology-2020/images&#39;),Path(&#39;/home/jupyter/kaggle/plant-pathology/data/plant-pathology-2020/predictions_fold_4.csv&#39;),Path(&#39;/home/jupyter/kaggle/plant-pathology/data/plant-pathology-2020/TESTING.csv&#39;),Path(&#39;/home/jupyter/kaggle/plant-pathology/data/plant-pathology-2020/.ipynb_checkpoints&#39;),Path(&#39;/home/jupyter/kaggle/plant-pathology/data/plant-pathology-2020/predictions_fold_1.csv&#39;),Path(&#39;/home/jupyter/kaggle/plant-pathology/data/plant-pathology-2020/train.csv&#39;),Path(&#39;/home/jupyter/kaggle/plant-pathology/data/plant-pathology-2020/submission.csv&#39;),Path(&#39;/home/jupyter/kaggle/plant-pathology/data/plant-pathology-2020/sample_submission.csv&#39;)...],
 1821)</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">path</span><span class="p">,</span> <span class="n">df</span> <span class="o">=</span> <span class="n">load_data</span><span class="p">(</span><span class="n">path_pseudo_labels</span><span class="o">=</span><span class="s2">&quot;~/kaggle/plant-pathology/exps/baseline/TESTING_PSEUDO_LABELS.csv&quot;</span><span class="p">)</span>
<span class="n">df</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>image_id</th>
      <th>healthy</th>
      <th>multiple_diseases</th>
      <th>rust</th>
      <th>scab</th>
      <th>fold</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Train_1511</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>1.000000</td>
      <td>0.000000e+00</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Train_1799</td>
      <td>1.000000e+00</td>
      <td>0.000000e+00</td>
      <td>0.000000</td>
      <td>0.000000e+00</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Train_135</td>
      <td>1.000000e+00</td>
      <td>0.000000e+00</td>
      <td>0.000000</td>
      <td>0.000000e+00</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Train_408</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>1.000000</td>
      <td>0.000000e+00</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Train_1693</td>
      <td>1.000000e+00</td>
      <td>0.000000e+00</td>
      <td>0.000000</td>
      <td>0.000000e+00</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>3200</th>
      <td>Test_1815</td>
      <td>1.739019e-07</td>
      <td>3.421622e-07</td>
      <td>1.000000</td>
      <td>4.958453e-10</td>
      <td>-1.0</td>
    </tr>
    <tr>
      <th>3201</th>
      <td>Test_1816</td>
      <td>3.261356e-08</td>
      <td>1.696263e-05</td>
      <td>0.999983</td>
      <td>1.126221e-11</td>
      <td>-1.0</td>
    </tr>
    <tr>
      <th>3202</th>
      <td>Test_1818</td>
      <td>1.389328e-07</td>
      <td>1.130557e-04</td>
      <td>0.999887</td>
      <td>4.712892e-10</td>
      <td>-1.0</td>
    </tr>
    <tr>
      <th>3203</th>
      <td>Test_1819</td>
      <td>9.999977e-01</td>
      <td>1.068754e-06</td>
      <td>0.000001</td>
      <td>2.593171e-07</td>
      <td>-1.0</td>
    </tr>
    <tr>
      <th>3204</th>
      <td>Test_1820</td>
      <td>1.067549e-04</td>
      <td>1.290270e-02</td>
      <td>0.000003</td>
      <td>9.869872e-01</td>
      <td>-1.0</td>
    </tr>
  </tbody>
</table>
<p>3205 rows Ã— 6 columns</p>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Create-Folds">Create Folds<a class="anchor-link" href="#Create-Folds"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="create_folds" class="doc_header"><code>create_folds</code><a href="https://github.com/bwolfson97/plant_pathology/tree/master/plant_pathology/utils.py#L21" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>create_folds</code>(<strong><code>path</code></strong>:<code>Path</code>, <strong><code>df</code></strong>:<code>DataFrame</code>, <strong><code>prn_stats</code></strong>:<code>bool</code>=<em><code>False</code></em>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">path</span><span class="p">,</span> <span class="n">df</span> <span class="o">=</span> <span class="n">load_data</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
<span class="n">create_folds</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">df</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Print-Command-to-Submit-to-Kaggle">Print Command to Submit to Kaggle<a class="anchor-link" href="#Print-Command-to-Submit-to-Kaggle"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="kaggle_submit_command" class="doc_header"><code>kaggle_submit_command</code><a href="https://github.com/bwolfson97/plant_pathology/tree/master/plant_pathology/utils.py#L38" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>kaggle_submit_command</code>()</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">kaggle_submit_command</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>!kaggle competitions submit -c plant-pathology-2020-fgvc7 -f {submission_path} -m &#39;hi&#39;
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Average-Predictions">Average Predictions<a class="anchor-link" href="#Average-Predictions"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="average_preds" class="doc_header"><code>average_preds</code><a href="https://github.com/bwolfson97/plant_pathology/tree/master/plant_pathology/utils.py#L42" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>average_preds</code>(<strong><code>path</code></strong>:<code>Path</code>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s2">&quot;/home/jupyter/kaggle/plant-pathology/exps/baseline/&quot;</span><span class="p">);</span> <span class="n">path</span><span class="o">.</span><span class="n">ls</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>(#5) [Path(&#39;/home/jupyter/kaggle/plant-pathology/exps/baseline/log.txt&#39;),Path(&#39;/home/jupyter/kaggle/plant-pathology/exps/baseline/.ipynb_checkpoints&#39;),Path(&#39;/home/jupyter/kaggle/plant-pathology/exps/baseline/predictions_fold_1.csv&#39;),Path(&#39;/home/jupyter/kaggle/plant-pathology/exps/baseline/predictions_fold_2.csv&#39;),Path(&#39;/home/jupyter/kaggle/plant-pathology/exps/baseline/predictions_fold_3.csv&#39;)]</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">average_preds</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

<span class="n">test_eq</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">),</span> <span class="mi">1821</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Save-Averaged-Preds">Save Averaged Preds<a class="anchor-link" href="#Save-Averaged-Preds"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="save_average_preds" class="doc_header"><code>save_average_preds</code><a href="https://github.com/bwolfson97/plant_pathology/tree/master/plant_pathology/utils.py#L49" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>save_average_preds</code>(<strong><code>path</code></strong>:"Path to prediction CSVs"=<em><code>'.'</code></em>, <strong><code>name</code></strong>:"Name"=<em><code>'averaged_predictions.csv'</code></em>)</p>
</blockquote>
<p>Average predictions from multiple folds.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">avg_preds_path</span> <span class="o">=</span> <span class="n">save_average_preds</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;TESTING_AVG_PREDS.csv&quot;</span><span class="p">)</span>

<span class="k">assert</span> <span class="n">avg_preds_path</span><span class="o">.</span><span class="n">exists</span><span class="p">()</span>
<span class="n">avg_preds_path</span><span class="o">.</span><span class="n">unlink</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

</div>
 

